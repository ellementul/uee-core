# UEE
United Events Environment


## Задачи:

- DB module только хранит различного типа сущности
- На данный момент он должен уметь сохранять сущность модуля и загружать
- 
- Дописать тест для проверки сохранение и загрузки модуля

- Создать новый тест для новой системы
- Добавить в менеджер функцию загрузки модуля
- Убрать приватные методы менеджера в абстрасктного родителя
- В тесте проверить что DB модуль загружается
- В тесте дать команду на запуск DB модуля и проверить что система храения сообщаила о готовности

- Создать модуль с хранилищем
- Написать тест для него проверяющий работу его состояний
- Добавить в тест проверку того что сохранения хранилища работает

- В тесте для системы хранения добавить новый модуль с хранилищем
- Проверить что он стартует автоматически когда зависит только от системы хранения
- Проверить что пересоздание модуля с нуля не потеряет данные внутри хранилища

- Переделать фабрику для запуска среды
  - Фабрика принимает в аргументы конфиг для перменных среды
  - Конфиг это json файл который не трекается в гите
  - Фабрика принимает системы в качестве аргумента, эти системы заранее содержат уже конструкторы для модулей это системы
  - Передать фабрике в качестве теста систему хранения
  - Сделать дефолтным адаптером для базы данных NoDB
  - Путь к файлу для базы должен быть передан через конфиг


- Разделить фабрики на серверную и браузерную
- Перейти на [https://parceljs.org/getting-started/webapp/]
- Серверная фабрика должна запускать сборку модулей в бандл в папку статики
- Серверная Фабрика должна стартовать сервер для раздачи статики
- Серверная Фабрика должна стартовать серверную среду
- Серверная Фабрика должна стартовать сервер для сокетов без команды
- Браузерная фабрика должна обязательно ожидать UI system в качестве аргумента


Определить UI модуль


- Создать мета модуль из state module
- Первую систему объявляет о готовности Менеджер
- Так же менеджер передает мета модулю список систем, и типов модулей которые в них участвуют.
- Присуствие модуля в системе должно быть обязательным, иначе модуль не часть этой системы.
- Готовность системы объявляется только тогда когда все модули
- Статус всех систем должен отслеживать сам метамодуль, в том числе пинговать каждого менеджера и модули в каждой системе(часть их он может не пинговать, а просто ловить от них сообщения)

- Фабрика больше не принимает готовые объекты, а только конструторы
- Фабрика принимает мета модуль отдельно и опционально
- Фабрика не просто функция, а служба.
- Проверить все это в тесте для фабрики.
- СДелать фукнции наблюдения асинхронными
- Исправить импорты
- Документировать новый модуль 



TODO: Added Meta Module
Defined six events-methods:
State: null
Build
State: Builded
Load
State: loaded
Run //Избавится от публичного метода и от запуска его в менеджере, для запуска этого метода и остальных передавать сообщение модулю.
State: Running
State: Readonly
Sleep
State: Sleeping
OnlyRead
Stop
State: null
Эти сообщения существуют в системе событий управления модулями.
Модуль может изменить свое состояние по запросу полученого сообщения.
Когда стартует среда, она может перевести определеные модули в определеное состояние с помощью передачи им серии сообщений.
Начальное состояние любого только что созданого модуля, это builded.
Когда менеджер меняет состояние модуля он сообщает об это в систему
Модуль после смены состояния извещает об этом всех.

Менеджер модулей не решает задачу какие модули нужно добавить, а какие усыпить или остановить.
Менеджеры модулей только обмениваются списком запущеных модулей между собой.
Но менеджеры запускают модули если получат об этом сообщение, менеджеры могут решать кто из них конкретно запустит этот модуль.

TODO: Ping between Managers by ServerTime, there are list modules in ping for checking avalibility modules
TODO: event faster then running module(accamulate events)


```javascript
class YourModule extends UEEModule {
  constructor (yourModuleParams) {

  }

  defEvents () {
    return [{
      // Define event signature 
      name: 'YourEvent', 
      payloadType: { 
        system: "YourSystemName(Or empty)", 
        entity: "NameObject(Or empty)"
      } 
    }]
  }
}
```

And your module send UEEManager to run
```javascript
import { UEE } from 'uee'
import YourModule from 'your-module.js'
import YourTransport from 'your-transport.js'
new UEE({
  transport: new YourTransport(transportParams),
  modules: [new YourModule(yourModuleParams)],
  isRun: true,
})
```